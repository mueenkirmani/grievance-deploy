import{r as c,j as e,c as h,Q as x,S as u,g as m,L as g,F as j,a as y,b as f,d as b,e as v,f as w}from"./index-ed031c35.js";import{C as N}from"./ComplaintGrid-5c23dfb4.js";function C({getData:l,setAddComplaintModal:d}){const[r,n]=c.useState("idle"),i=async o=>{o.preventDefault();const{category:p}=o.target.elements;try{n("pending"),await h({category:p.value}),n("resolved"),l(),d(!1)}catch(s){n("rejected"),x.error(s.response.data.message||"Something went wrong")}};return e.jsx("div",{onClick:()=>d(!1),onKeyDown:o=>{o.key==="Escape"&&d(!1)},role:"button",tabIndex:0,className:"fixed inset-0 flex items-center justify-center bg-slate-800/50",children:e.jsx("div",{onClick:o=>o.stopPropagation(),role:"button",tabIndex:0,className:"w-full max-w-sm rounded-md bg-white p-10 text-center",children:e.jsxs("form",{onSubmit:i,children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Add Complaint"}),e.jsxs("select",{name:"category",className:"my-10 w-full rounded-lg border px-2 py-1 focus:outline-none",children:[e.jsx("option",{value:"electrician",children:"Electricity"}),e.jsx("option",{value:"plumbing",children:"Plumbing"}),e.jsx("option",{value:"carpenter",children:"Carpentry"}),e.jsx("option",{value:"others",children:"Others"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{type:"button",className:"rounded-md bg-red-500 px-4 py-2 text-lg text-white",onClick:()=>d(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:`rounded-md bg-green-600 px-7 py-2 text-lg font-semibold text-white
              ${r==="pending"&&"cursor-not-allowed opacity-50"}
              `,children:r==="pending"?"Adding...":"Add"})]})]})})})}const S=[{name:"All",value:""},{name:"Open",value:"open"},{name:"In Progress",value:"in-progress"},{name:"Done",value:"done"}];function k(){const[l,d]=c.useState([]),[r,n]=c.useState("idle"),[i,o]=c.useState(""),[p,s]=c.useState(!1),a=async()=>{try{n("pending");const t=await m(i);d(t.data.data),n("resolved")}catch(t){n("rejected"),console.log(t)}};return c.useEffect(()=>{a()},[i]),e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"py-5 text-4xl font-bold",children:"All Complaints"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{type:"button",className:"rounded-lg bg-green-600 px-4 py-2 text-white",onClick:()=>s(!0),children:"Add Complaint"}),e.jsxs("div",{className:"flex items-center justify-end gap-3",children:[e.jsx("p",{children:"Filter"}),e.jsx("select",{className:"rounded-lg border px-2 py-1 focus:outline-none",onChange:t=>{o(t.target.value)},value:i,children:S.map(t=>e.jsx("option",{value:t.value,children:t.name},t.value))})]})]}),e.jsxs("div",{className:`grid grid-cols-1 place-items-start gap-10 py-10 
      
      ${r==="resolved"&&l.complaints.length===0?"md:grid-cols-1":"md:grid-cols-2"}`,children:[r==="resolved"&&l.complaints.map(t=>e.jsx(N,{item:t},t._id)),r==="resolved"&&l.complaints.length===0&&e.jsx("div",{className:"w-full rounded-lg border bg-white px-8 py-6 shadow-md",children:e.jsx("h2",{className:"mb-4 text-2xl font-bold",children:"No Complaints"})})]}),r==="pending"&&e.jsx("div",{className:"flex h-96 items-center justify-center",children:e.jsx(u,{})}),p&&e.jsx(C,{addComplaintModal:p,setAddComplaintModal:s,getData:a})]})}const D=[{label:"Open",value:"open"},{label:"In Progress",value:"in-progress"},{label:"Done",value:"done"}];function O(){const[l,d]=c.useState([]),[r,n]=c.useState("idle"),i=async()=>{try{n("pending");const s=await f();d(s.data.data),n("resolved")}catch(s){n("rejected"),x.error(s.response.data.message||"Something went wrong"),console.log(s)}},o=async(s,a)=>{s.preventDefault();try{await b({complaintId:a}),x.success("Complaint Locked")}catch(t){n("rejected"),x.error(t.response.data.message||"Something went wrong")}finally{i()}},p=async(s,a)=>{s.preventDefault();try{await v({complaintId:a,status:s.target.value}),x.success("Status Updated")}catch(t){n("rejected"),x.error(t.response.data.message||"Something went wrong"),console.log(t)}};return c.useEffect(()=>{i()},[]),e.jsxs("div",{children:[e.jsx("h1",{className:"py-5 text-4xl font-bold",children:"Complaints Raised"}),e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"overflow-x-auto sm:-mx-6 lg:-mx-8",children:e.jsx("div",{className:"inline-block min-w-full py-2 sm:px-6 lg:px-8",children:e.jsx("div",{className:"overflow-hidden",children:e.jsxs("table",{className:"min-w-full text-left text-sm font-light",children:[e.jsx("thead",{className:"border-b font-medium dark:border-neutral-500",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-4",children:"Complaint ID"}),e.jsx("th",{scope:"col",className:"px-6 py-4",children:"Complaint Status"}),e.jsx("th",{scope:"col",className:"px-6 py-4",children:"Raised By"}),e.jsx("th",{scope:"col",className:"px-6 py-4 ",children:"Raised On"}),e.jsx("th",{scope:"col",className:"px-6 py-4 ",children:"Updated On"}),e.jsx("th",{scope:"col",className:"px-6 py-4",children:"Action"})]})}),e.jsxs("tbody",{children:[r==="resolved"&&l.complaints.map(s=>e.jsxs("tr",{className:"border-b transition duration-300 ease-in-out hover:bg-neutral-100 dark:border-neutral-500 dark:hover:bg-neutral-300",children:[e.jsx("td",{className:"whitespace-nowrap px-6 py-4 font-medium",children:s._id}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4",children:s.lockedBy?e.jsx("select",{className:"rounded-lg border border-gray-300 px-2 py-1 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-indigo-600",onChange:a=>{p(a,s._id)},defaultValue:s.status,children:D.map(a=>e.jsx("option",{value:a.value,defaultValue:a.value===s.status,children:a.label},a.value))}):e.jsxs(e.Fragment,{children:[s.status==="open"&&e.jsx("span",{className:"rounded-lg bg-red-500 px-2 py-1 text-white",children:"Open"}),s.status==="in-progress"&&e.jsx("span",{className:"rounded-lg bg-yellow-500 px-2 py-1 text-white",children:"In Progress"}),s.status==="done"&&e.jsx("span",{className:"rounded-lg bg-green-500 px-2 py-1 text-white",children:"Done"})]})}),e.jsx("td",{className:"cursor-pointer whitespace-nowrap px-6 py-4 text-base font-medium capitalize text-indigo-900",children:e.jsx(g,{to:`/user/${s.userId._id}`,className:"text-indigo-600 hover:text-indigo-900",children:s.userId.name})}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4",children:s.createdAt?new Date(s.createdAt).toLocaleString():""}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4",children:s.createdAt?new Date(s.updatedAt).toLocaleString():""}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4",children:e.jsx("button",{type:"button",className:"rounded-lg px-4 py-2 text-white disabled:cursor-not-allowed ",onClick:a=>o(a,s._id),disabled:s.lockedBy,children:s.lockedBy?e.jsx(j,{size:25,className:"text-yellow-600"}):e.jsx(y,{size:25,className:"text-gray-800"})})})]},s._id)),r==="pending"&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(u,{size:50,type:"inner"})})})}),r==="resolved"&&l.complaints.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:e.jsx("div",{className:"flex h-96 items-center justify-center",children:e.jsx("p",{className:"text-2xl",children:"No Complaints Open or Raised"})})})})]})]})})})})})]})}function L(){const{role:l}=w();if(l==="consumer")return e.jsx(k,{});if(l==="provider")return e.jsx(O,{})}export{L as default};
